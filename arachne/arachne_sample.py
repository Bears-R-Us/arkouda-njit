"""Sample Arachne Script

This script provides an example on how a graph is built in Arachne from two Arkouda arrays and then
analyzed using Arachne functions. The graphs are randomly generated by using the ak.randint function
with the range of the vertex names being picked from 0..<n and the number of edges m. No special
distribution is used to generated the graph e.g. RMAT. 

The values of n and m are accepted from command line input. It requires Arkouda and Arachne to both
be pip installed in the environment. 

Assumes Arkouda server is running. It will shutdown the Arkouda server upon completion.

Sample usage: python3 arachne_simple_tests.py n51 5555 -n 5000 -m 20000

"""
import argparse
import time
import arkouda as ak
import arachne as ar
import networkx as nx

def create_parser():
    """Creates the command line parser for this script"""
    script_parser = argparse.ArgumentParser(
        description="Simple script showcasing all the functionality of Arachne on a random graph of\
                     size specified by the user."
    )
    script_parser.add_argument("hostname", help="Hostname of arkouda server")
    script_parser.add_argument("port", type=int, default=5555, help="Port of arkouda server")
    script_parser.add_argument("n", type=int, default=1000, help="Number of vertices for graph")
    script_parser.add_argument("m", type=int, default=2000, help="Number of edges for graph")

    return script_parser

if __name__ == "__main__":
    # Command line parser and extraction.
    parser = create_parser()
    args = parser.parse_args()

    # Connect to the Arkouda server.
    ak.verbose = False
    ak.connect(args.hostname, args.port)

    ### Build graph from randonmly generated source and destination arrays.
    # 1a. Use Arkouda's randint to generate the random edge arrays.
    # src = ak.randint(0, args.n, args.m)
    # dst = ak.randint(0, args.n, args.m)
    # wgt = ak.randint(0, args.n, args.m, dtype=ak.float64)
    src = ak.array([2,5,2,3,3,3,2,3,5,5,5,7,8,8,9 ,10,10,24,25,25])
    dst = ak.array([1,0,0,0,3,3,3,4,5,2,7,8,9,5,10,7 ,7 ,24,26,27])
    wgt = ak.array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 ,1 ,1 ,10,20,20])

    print("Building undirected graph...")
    start = time.time()
    graph = ar.Graph()
    graph.add_edges_from(src, dst, wgt)
    end = time.time()
    print(f"Building undirected graph with {graph.n_vertices} vertices and {graph.n_edges} edges "
          f"took {end-start} seconds")
    print()

    print("Building directed graph...")
    start = time.time()
    di_graph = ar.DiGraph()
    di_graph.add_edges_from(src, dst, wgt)
    end = time.time()
    print(f"Building directed graph with {di_graph.n_vertices} vertices and {di_graph.n_edges} "
          f"edges took {end-start} seconds")
    print()

    s,d = graph.edges()
    print(s)
    print(d)
    print(graph.nodes())

    s,d = di_graph.edges()
    print(s)
    print(d)
    print(di_graph.nodes())

    ## Run breadth-first search on the input graphs.
    start = time.time()
    graph_bfs_layers = ar.bfs_layers(graph, 9)
    end = time.time()
    print(f"Running breadth-first search on undirected graph took {end-start} seconds")
    print(graph_bfs_layers)

    start = time.time()
    di_graph_bfs_layers = ar.bfs_layers(di_graph, 9)
    end = time.time()
    print(f"Running breadth-first search on directed graph took {end-start} seconds")
    print(di_graph_bfs_layers)

    ak.shutdown()
